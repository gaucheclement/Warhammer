<script>
    var DataTree = function (CharGen) {
        var typeItem = 'tree';
        var labelItem = 'Chapitre'
        var oThat = DataFunctions.createDataObject(CharGen, typeItem, false, labelItem);
        oThat.allByType = {};
        oThat.createElemStructure = function (el) {
            if (typeof el.suffix !== 'undefined' && el.suffix) {
                el.labelItem = el.suffix;
            }
            el.getDescription = function () {
                var elem = this.getData();
                var labels = CharGen.allForHelp;
                return DescriptionHelper.applyHelp(elem.desc, elem, {...labels.characteristic, ...labels.trait, ...labels.talent, ...labels.lore, ...labels.skill, ...labels.god, ...labels.spell, ...labels.etat, ...labels.psychologie, ...labels.magick, ...labels.quality, ...labels.career, ...labels.tree});
            }
            el.getLinkedFolder = function () {
                if (this.folder) {
                    return CharGen.data.tree.allById[Helper.toId(this.folder)]
                }
                return false;
            }
            el.edit = function () {
                var html = EditHelper.inputHidden(this.typeItem, 'typeItem');
                html += EditHelper.inputHidden(this.insertMode, 'insertMode');
                html += EditHelper.inputHidden(this.index, 'index');
                html += EditHelper.paragraph('Dossier parent', EditHelper.inputText(this.folder, 'folder', '', true), true)
                html += EditHelper.paragraph('Type', EditHelper.inputText(this.type, 'type', '', true), true)
                html += EditHelper.paragraph('Sous type', EditHelper.inputText(this.subType, 'subType', '', true), true)
                html += EditHelper.inputName(CharGen, this);
                html += EditHelper.inputBookAndPage(CharGen, this);
                html += EditHelper.paragraph('Description', EditHelper.inputTextArea(this.desc, 'desc', 'desc'))
                return html;
            }
            if (typeof oThat.allByType[el.type] === 'undefined') {
                oThat.allByType[el.type] = {};
            }
            if (el.subType) {
                oThat.allByType[el.type][el.subType] = el;
            }
            oThat.allByType[el.type][Helper.toId(el.label)] = el;
        }
        oThat.generateId = function (el) {
            return el.type + '|' + Helper.toId(el.label);
        }
        oThat.parseElems = function (el, match) {
        }

        return oThat;
    }
    this.DataTree = DataTree;
</script>