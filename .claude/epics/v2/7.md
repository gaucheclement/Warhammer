---
name: Admin Mode
status: open
created: 2025-10-24T13:37:39Z
updated: 2025-10-24T14:01:23Z
github: https://github.com/gaucheclement/Warhammer/issues/7
depends_on: [4, 6]
parallel: true
conflicts_with: []
---

# Task: Admin Mode

## Description

Implement the password-protected admin mode that allows the site administrator to edit the official database, review community contributions, and generate updated data exports. This is a specialized interface for maintaining the official data and managing community submissions.

## Acceptance Criteria

- [ ] Admin login page with password authentication (SHA-256 hash)
- [ ] Admin session persists across page reloads (localStorage)
- [ ] Admin-only UI elements hidden for regular users
- [ ] Edit official data interface (full CRUD for all 23 entity types)
- [ ] Community contribution review workflow (import, preview, approve/reject)
- [ ] Export updated `all-data.json` after approving contributions
- [ ] Admin dashboard showing stats (total entries, pending contributions, etc.)
- [ ] Admin logout functionality
- [ ] Security: No sensitive data in client-side code (password hash only)

## Technical Details

**Implementation Approach:**

1. **Admin Authentication (`src/pages/AdminLogin.svelte`):**
   ```javascript
   // Password hashing (client-side)
   const hash = await crypto.subtle.digest(
     'SHA-256',
     new TextEncoder().encode(password)
   )
   const hashHex = Array.from(new Uint8Array(hash))
     .map(b => b.toString(16).padStart(2, '0'))
     .join('')

   // Compare with stored hash (in code or env variable)
   const ADMIN_HASH = 'abc123...' // Pre-computed hash
   if (hashHex === ADMIN_HASH) {
     localStorage.setItem('adminAuth', 'true')
     // Redirect to admin dashboard
   }
   ```

   **Security Note:** Password hash stored in code (not ideal but acceptable for small user base). Future: Use backend auth.

2. **Admin Session Management (`src/lib/adminAuth.js`):**
   ```javascript
   export function isAdmin() {
     return localStorage.getItem('adminAuth') === 'true'
   }

   export function logout() {
     localStorage.removeItem('adminAuth')
     // Redirect to home
   }
   ```

   - Check `isAdmin()` before rendering admin UI
   - Middleware for protected routes

3. **Admin Dashboard (`src/pages/AdminDashboard.svelte`):**
   - Stats cards:
     - Total official entries (by type)
     - Total custom modifications in community
     - Pending contributions (if tracked)
   - Quick actions:
     - Edit official data
     - Review contributions
     - Export official database
   - Recent activity log (optional)

4. **Edit Official Data Interface (`src/pages/AdminEditData.svelte`):**
   - Similar to custom content creator but edits official data
   - Table view of all entities (filterable by type)
   - Inline editing or modal editor
   - Save → update `officialData` in IndexedDB
   - Mark as "official" (no custom badge)
   - Confirmation before saving changes

5. **Community Contribution Review (`src/pages/AdminReviewContributions.svelte`):**
   - Upload area: User submits JSON patch file
   - Parse uploaded file
   - Display all proposed changes:
     - New entries: Show full content
     - Modified entries: Show diff (before/after)
   - Actions per entry:
     - ✅ Approve (add to official data)
     - ❌ Reject (discard)
     - ✏️ Edit (modify before approval)
   - Bulk actions: Approve all / Reject all
   - After approval: Merge into `officialData`

6. **Export Official Database (`src/lib/adminExport.js`):**
   ```javascript
   export function exportOfficialData() {
     // Get current officialData from store
     const data = get(officialData)

     // Format as all-data.json structure
     const exportData = {
       book: data.books,
       career: data.careers,
       careerLevel: data.careerLevels,
       // ... all 23 types
     }

     // Download as JSON
     downloadJSON(exportData, `all-data-${new Date().toISOString()}.json`)
   }
   ```

   - Exported file replaces `data/all-data.json` in source
   - Rebuild app to embed updated data

7. **Admin UI Indicators:**
   - Admin badge in header when logged in
   - "Admin Mode" banner across top (optional, for visibility)
   - Admin-only buttons/sections (conditionally rendered)

**Code Locations:**
- `src/pages/AdminLogin.svelte` - Login page
- `src/pages/AdminDashboard.svelte` - Admin home
- `src/pages/AdminEditData.svelte` - Edit official data
- `src/pages/AdminReviewContributions.svelte` - Review community submissions
- `src/lib/adminAuth.js` - Authentication utilities
- `src/lib/adminExport.js` - Export official data
- `src/stores/admin.js` - Admin state (if needed)

**Key Considerations:**
- Security: This is client-side only auth (not production-grade, but sufficient for single admin)
- Future: Move to backend auth if more admins needed
- UX: Make admin actions clearly labeled and hard to undo accidentally
- Data integrity: Validate official data edits (prevent breaking changes)
- Backup: Encourage exporting backup before making changes

## Dependencies

- [ ] Task 4 completed (UI components)
- [ ] Task 6 completed (import/export utilities to reuse)
- [ ] Admin password set (generate SHA-256 hash)
- [ ] Web Crypto API available (modern browsers)

## Effort Estimate

- Size: M (Medium)
- Hours: 12-16 hours
- Parallel: true (can work alongside other tasks)

**Breakdown:**
- Admin authentication and session management: 3h
- Admin dashboard: 2h
- Edit official data interface: 4h
- Community contribution review workflow: 4h
- Export official database: 2h
- Security hardening and testing: 3h

## Definition of Done

- [ ] Admin can log in with password (hashed with SHA-256)
- [ ] Admin session persists across page reloads
- [ ] Admin can edit official data for all entity types
- [ ] Admin can review and approve/reject community contributions
- [ ] Admin can export updated `all-data.json`
- [ ] Admin UI elements hidden from non-admin users
- [ ] Logout functionality works correctly
- [ ] No console errors in admin mode
- [ ] Tested with real contribution JSON file (import, review, approve)
- [ ] Security: Password not visible in source code (hash only)
