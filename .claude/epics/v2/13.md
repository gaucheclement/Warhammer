---
name: Custom Content & Modifications
status: completed
archived: true
archived_at: 2025-11-02T09:42:10Z
archived_reason: GitHub issue deleted
created: 2025-10-24T13:37:39Z
updated: 2025-10-24T17:36:30Z
completed: 2025-10-24T17:36:30Z
last_sync: 2025-10-24T17:36:30Z
github: https://github.com/gaucheclement/Warhammer/issues/13
depends_on: []
parallel: true
conflicts_with: [10]
---

# Task: Custom Content & Modifications

## Description

Implement the system for users to modify official data and create custom content locally. This includes a contextual edit mode for modifying any official data entry, a custom content creator for adding new entities, visual indicators to distinguish official vs custom vs modified content, and export/import of modifications as JSON patch files.

This feature enables community contributions and homebrew content.

## Acceptance Criteria

- [ ] Edit mode toggle to modify any official data entry inline
- [ ] Visual indicators: badges or colors for official/custom/modified entries
- [ ] Custom content creator form for all 23 entity types
- [ ] Field validation for custom content (required fields, types)
- [ ] Preview custom content before saving
- [ ] Export modifications as JSON patch file (only changes, not full dataset)
- [ ] Import JSON patch files with conflict resolution UI
- [ ] Reset individual entries to official values
- [ ] Bulk reset all modifications option
- [ ] Modification history (optional: track changes with timestamps)

## Technical Details

**Implementation Approach:**

1. **Edit Mode (`src/components/EditMode.svelte`):**
   - Toggle button: "Enable Edit Mode"
   - When enabled, all data entries show "Edit" button
   - Click "Edit" → open inline editor or modal
   - Edit form matches entity type (talent, spell, career, etc.)
   - Save → mark as modified, store in `customModifications` store
   - Visual indicator: Orange badge "Modified"

12. **Custom Content Creator (`src/pages/CustomContentCreator.svelte`):**
   - Dropdown to select entity type (Career, Talent, Spell, etc.)
   - Dynamic form based on selected type
   - Required fields enforced (e.g., name, description)
   - Optional fields collapsible (reduce clutter)
   - Preview pane shows how it will appear
   - Save → add to `customModifications` with `isCustom: true`
   - Visual indicator: Blue badge "Custom"

15. **Visual Indicators:**
   - **Official:** Default (no badge or green checkmark)
   - **Modified:** Orange badge or icon
   - **Custom:** Blue badge or icon
   - **Deleted:** Red strikethrough (soft delete)

   Implement as a reusable component: `<Badge type="custom" />`

17. **Data Model for Modifications:**
   ```javascript
   // customModifications store structure
   {
     talents: {
       'talent-id-123': {
         ...modifiedFields,
         _meta: {
           isCustom: false,
           isModified: true,
           originalId: 'talent-id-123',
           modified: timestamp
         }
       },
       'custom-talent-456': {
         ...customFields,
         _meta: {
           isCustom: true,
           created: timestamp
         }
       }
     },
     careers: { /* same structure */ },
     // ... for all 23 entity types
   }
   ```

10. **Export Modifications (`src/lib/exportModifications.js`):**
   ```javascript
   // Export format
   {
     version: '12.0',
     exported: timestamp,
     author: 'User Name (optional)',
     modifications: {
       talents: { /* only modified/custom talents */ },
       careers: { /* etc. */ }
     }
   }
   ```
   - Trigger download as `warhammer-mods-YYYYMMDD.json`
   - Only include modified/custom entries (not full dataset)
   - Include metadata for conflict resolution

13. **Import Modifications (`src/lib/importModifications.js`):**
   - File input: accept `.json`
   - Validate JSON structure
   - Detect conflicts: incoming mod ID matches existing custom mod
   - Conflict resolution UI:
     - "Keep existing", "Overwrite with import", "Merge fields"
   - Preview all changes before applying
   - Apply button → merge into `customModifications`

16. **Reset Functionality:**
   - **Individual reset:** Button on each modified entry
   - **Bulk reset:** "Reset all modifications" button (with confirmation)
   - Reset removes entry from `customModifications`, data store reverts to official

18. **Conflict Resolution UI (`src/components/ConflictResolver.svelte`):**
   - Show side-by-side comparison (existing vs import)
   - Highlight differences (color-coded fields)
   - Radio buttons: Keep existing / Use import / Merge
   - "Merge" option: select individual fields to keep/overwrite

**Code Locations:**
- `src/components/EditMode.svelte` - Edit mode toggle
- `src/pages/CustomContentCreator.svelte` - Custom content form
- `src/components/Badge.svelte` - Visual indicators
- `src/components/ConflictResolver.svelte` - Conflict resolution UI
- `src/lib/exportModifications.js` - Export utility
- `src/lib/importModifications.js` - Import utility
- `src/stores/customModifications.js` - Custom data store

**Key Considerations:**
- Data integrity: Validate all custom content (prevent broken references)
- UX: Make it obvious what's custom vs official
- Conflict resolution: Don't lose user data during imports
- Performance: Don't re-merge entire dataset on every modification
- Versioning: Include version in export for future compatibility

## Dependencies

- [ ] Task 15 completed (data stores and merging logic)
- [ ] Task 17 completed (UI components for forms)
- [ ] Understanding of data schema for all 23 entity types
- [ ] JSON validation library (optional: `ajv` for schema validation)

## Effort Estimate

- Size: L (Large)
- Hours: 16-20 hours
- Parallel: true (can work alongside Task 10 - different code areas)

**Breakdown:**
- Edit mode and inline editing: 4h
- Custom content creator with dynamic forms: 6h
- Visual indicators and badges: 2h
- Export modifications: 2h
- Import with conflict resolution: 4h
- Reset functionality: 2h
- Testing and edge cases: 4h

## Definition of Done

- [ ] Users can edit any official data entry and save modifications
- [ ] Users can create new custom content for all entity types
- [ ] Visual indicators clearly distinguish official/custom/modified entries
- [ ] Export generates valid JSON patch file with only modifications
- [ ] Import validates JSON and handles conflicts gracefully
- [ ] Reset functionality works for individual entries and bulk reset
- [ ] No data loss during import/export operations (tested)
- [ ] Custom content survives app reload (persisted in IndexedDB)
- [ ] Unit tests for import/export and conflict resolution (>70% coverage)
- [ ] Tested with community member submitting a custom talent pack
