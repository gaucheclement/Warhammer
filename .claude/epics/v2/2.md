---
name: Project Foundation & Build Setup
status: open
created: 2025-10-24T13:37:39Z
updated: 2025-10-24T14:01:23Z
github: https://github.com/gaucheclement/Warhammer/issues/2
depends_on: []
parallel: false
conflicts_with: []
---

# Task: Project Foundation & Build Setup

## Description

Initialize the Svelte + Vite project structure and configure the build system to produce a single-file HTML bundle with embedded assets. Integrate the existing `extract-data.js` script into the build pipeline and configure IndexedDB initialization to load the embedded data on first app launch.

This is the foundational task that sets up the entire development environment and build architecture. All other tasks depend on this infrastructure being in place.

## Acceptance Criteria

- [ ] Vite + Svelte project initialized with proper directory structure
- [ ] Vite configured to inline all CSS/JS into single HTML output file
- [ ] `extract-data.js` integrated as npm script (`npm run extract`)
- [ ] Build pipeline embeds `data/all-data.json` as base64 or inline JSON
- [ ] IndexedDB wrapper (Dexie.js) configured with schema for 23 entity types
- [ ] Initial data load script populates IndexedDB from embedded JSON on first run
- [ ] Dev server runs with hot module replacement (`npm run dev`)
- [ ] Production build generates single `dist/index.html` file < 500KB (before data)
- [ ] Build scripts documented in `package.json` with clear descriptions

## Technical Details

**Implementation Approach:**

1. **Project Initialization:**
   ```bash
   npm create vite@latest warhammer-v2 -- --template svelte
   cd warhammer-v2
   npm install
   ```

2. **Install Dependencies:**
   ```bash
   npm install dexie      # IndexedDB wrapper (~20KB)
   npm install -D vite-plugin-singlefile  # Inline assets plugin
   npm install -D vite-plugin-html        # HTML transformation
   ```

3. **Vite Configuration (`vite.config.js`):**
   - Configure `vite-plugin-singlefile` to inline all assets
   - Embed `data/all-data.json` as JavaScript constant
   - Set build target to ES2020
   - Configure minification (terser with aggressive settings)
   - Output to single `dist/index.html`

4. **IndexedDB Schema (`src/lib/db.js`):**
   - Define Dexie.js schema with 23 tables matching JSON structure
   - Tables: books, careers, careerLevels, species, classes, talents, characteristics, trappings, skills, spells, creatures, stars, gods, eyes, hairs, details, traits, lores, magicks, etats, psychologies, qualities, trees
   - Add indexes for common search fields (name, type, source book)
   - Implement version management for schema updates

5. **Data Initialization (`src/lib/initData.js`):**
   - Check if IndexedDB is already populated (flag in localStorage)
   - Parse embedded JSON data
   - Batch insert into IndexedDB tables (use Dexie bulk operations)
   - Set initialization flag after successful load
   - Handle errors gracefully (show user-friendly message)

6. **Build Scripts (`package.json`):**
   ```json
   {
     "scripts": {
       "extract": "node ../extract-data.js <WEBAPP_URL>",
       "dev": "vite",
       "build": "vite build",
       "preview": "vite preview"
     }
   }
   ```

**Code Locations:**
- `/warhammer-v2/` - New project directory
- `/warhammer-v2/vite.config.js` - Build configuration
- `/warhammer-v2/src/lib/db.js` - IndexedDB schema
- `/warhammer-v2/src/lib/initData.js` - Data initialization
- `/warhammer-v2/package.json` - Scripts and dependencies

**Key Considerations:**
- Ensure build process is reproducible across environments
- Keep existing `extract-data.js` in parent directory, reference from new project
- Bundle size monitoring (warn if exceeds 500KB before data)
- Consider compression level trade-offs (speed vs size)

## Dependencies

- [ ] Node.js 18+ installed
- [ ] npm or pnpm available
- [ ] Access to existing `extract-data.js` script
- [ ] Access to `data/all-data.json` (or ability to regenerate it)
- [ ] No task dependencies (foundational task)

## Effort Estimate

- Size: M (Medium)
- Hours: 12-16 hours
- Parallel: false (must complete before other tasks can start)

**Breakdown:**
- Project setup and dependency configuration: 3h
- Vite build config and single-file plugin setup: 4h
- IndexedDB schema design and Dexie.js setup: 3h
- Data initialization logic and error handling: 3h
- Testing and documentation: 3h

## Definition of Done

- [ ] Project runs locally with `npm run dev`
- [ ] Production build with `npm run build` generates single HTML file
- [ ] Built file size is < 500KB (gzipped, excluding embedded data)
- [ ] IndexedDB initializes with all 23 tables on first app load
- [ ] Data successfully loads from embedded JSON into IndexedDB
- [ ] Build process documented in README with clear instructions
- [ ] No console errors during dev or build
- [ ] Git repository initialized with proper `.gitignore`
