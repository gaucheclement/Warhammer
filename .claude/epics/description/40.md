---
name: Enhance Cross-Reference System for All Entity Types
status: closed
created: 2025-11-01T12:45:31Z
updated: 2025-11-01T17:09:30Z
github: https://github.com/gaucheclement/Warhammer/issues/40
depends_on: [36, 37]
parallel: true
conflicts_with: []
---

# Task: Enhance Cross-Reference System for All Entity Types

## Description
Extend the existing `applyHelp()` function to support all 20+ entity types (currently only supports subset). Add tooltip previews on hover, handle missing/invalid references gracefully, support nested references, and implement reference validation during generation.

## Acceptance Criteria
- [ ] `applyHelp()` extended to recognize all 20+ entity type patterns
- [ ] Pattern format: `{type:label}` works for all types (spell, creature, trait, etc.)
- [ ] Tooltip preview appears on hover showing entity summary (1-2 lines)
- [ ] Missing entity references show warning indicator (red underline)
- [ ] Invalid reference syntax handled gracefully (displayed as plain text)
- [ ] Nested references work: `{skill:Dodge}` inside a `{talent:Combat}` description
- [ ] Reference validation function available: `validateReferences(html)`
- [ ] Click on cross-reference triggers navigation event

## Technical Details
- **File to modify**: `src/lib/db-descriptions.js` (applyHelp function)
- **New patterns to support**:
  - `{spell:Boule de Feu}` → Link to spell
  - `{creature:Gobelin}` → Link to creature
  - `{trait:Effrayant (2)}` → Link to trait with spec
  - `{quality:Armor Piercing}` → Link to quality
  - `{book:WFRP Core}` → Link to book
  - ... all 20+ types from entity registry
- **Tooltip implementation**: Use title attribute or custom tooltip component
- **Validation**: Check entity exists in database before creating link
- **Error handling**: Log warning for broken references, display with visual indicator

**Enhanced Markup**:
```html
<span class="showHelp" data-type="skill" data-id="dodge" title="Esquive - Compétence de base">Dodge</span>
<span class="showHelp broken" data-type="spell" data-id="invalid" title="Référence introuvable">Invalid Spell</span>
```

## Dependencies
- [ ] Task 36 completed (all entity types available)
- [ ] Task 37 completed (navigation event handling)
- [ ] Entity registry with all type mappings

## Effort Estimate
- Size: M
- Hours: 16 hours (2 days)
- Parallel: true (can work alongside Task 39)

## Definition of Done
- [ ] All entity types recognized in cross-references
- [ ] Tooltip previews functional
- [ ] Missing reference handling works
- [ ] Validation function implemented
- [ ] Manual testing with 100+ cross-references
- [ ] 99%+ accuracy on cross-reference audit
- [ ] No console errors for broken references
