---
name: Fix Browse Modal for Entity ID 0 and Empty Content Display
status: open
created: 2025-11-01T22:00:00Z
updated: 2025-11-01T21:09:58Z
github: https://github.com/gaucheclement/Warhammer/issues/46
depends_on: [44]
parallel: false
conflicts_with: []
---

# Task: Fix Browse Modal for Entity ID 0 and Empty Content Display

## Description
The entity description modal has critical bugs affecting all entity types:
1. **First entity (ID 0) fails**: Modal shows "Entity type and ID are required" error
2. **Other entities display empty content**: Info/Related tabs are non-functional
3. **Wrong ID type for careers**: Using string ID instead of numeric ID

## Root Causes

### Issue 1: ID 0 Treated as Falsy
When `entityId` is `0`, JavaScript treats it as falsy in conditions like `if (entityId)`, causing validation to fail.

**Affected locations**:
- `EntityDescription.svelte` - Likely has `if (!entityType || !entityId)` check
- Modal opening logic - Passes ID 0 but validation rejects it

### Issue 2: Missing Relationship Configuration
Console shows: `No relationship configuration found for entity type: specie`

**Affected locations**:
- `db-relations.js:1608` - Missing configurations for `specie`, `career`, and other types
- Related tab cannot load without relationship config

### Issue 3: Career ID Type Mismatch
Error: `Entity not found: career with ID "Agitateur"`
- Career is using string name instead of numeric ID
- Other entity types use numeric IDs correctly

## Acceptance Criteria
- [ ] Entity with ID 0 opens successfully (all entity types)
- [ ] Modal shows full entity information for ID 0
- [ ] All entities display Info tab content
- [ ] Related tab shows related entities (or "No relations" message)
- [ ] Career entities use correct numeric ID instead of string name
- [ ] No console errors when opening any entity
- [ ] Info and Related tabs are functional and switchable
- [ ] Manual testing completed for: species, careers, skills, talents, spells

## Technical Details

### Files to Fix

1. **EntityDescription.svelte**
   - Replace `if (!entityId)` with `if (entityId === null || entityId === undefined)`
   - Ensure ID 0 is treated as valid
   - Add proper error handling for missing entity data

2. **db-relations.js**
   - Add relationship configurations for `specie`, `career`, and all missing types
   - Map type names: `specie` → `species`, `career` → `careers`
   - Ensure line 1608 handles all entity types

3. **Browse.svelte**
   - Verify career entities pass numeric ID, not string name
   - Check `handleEntityClick` passes correct ID format
   - Debug: log entity object before opening modal

4. **DescriptionModal.svelte** (if exists)
   - Verify it properly handles `entityId: 0`
   - Check prop validation doesn't reject falsy numbers

### Expected Fixes

```javascript
// BEFORE (breaks on ID 0)
if (!entityType || !entityId) {
  throw new Error("Entity type and ID are required")
}

// AFTER (works with ID 0)
if (!entityType || entityId === null || entityId === undefined) {
  throw new Error("Entity type and ID are required")
}
```

```javascript
// db-relations.js - Add missing configs
const RELATIONSHIP_CONFIG = {
  // Add these missing types
  specie: { /* config */ },
  career: { /* config */ },
  // Ensure all 20+ types are covered
}
```

## Dependencies
- [ ] Issue #44 (Modal integration) - This bug blocks full testing of #44
- [ ] Understanding of current entity ID conventions
- [ ] Access to entity data structure for all types

## Effort Estimate
- Size: S
- Hours: 2-4 hours
- Parallel: false (blocks #44 testing)

## Definition of Done
- [ ] ID 0 entities open successfully
- [ ] All entity types display full content in modal
- [ ] Info tab shows entity details
- [ ] Related tab shows relationships or appropriate message
- [ ] No console errors for any entity type
- [ ] Career ID type corrected
- [ ] Manual testing passed for all Browse categories
- [ ] Regression test: ID 1+ still works correctly
