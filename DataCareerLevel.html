<script>
    var DataCareerLevel = function (CharGen) {
        var typeItem = 'careerLevel';
        var labelItem = 'Niveau de';
        var oThat = DataFunctions.createDataObject(CharGen, typeItem, false, labelItem);
        oThat.allByCareer = {};
        oThat.createElemStructure = function (el) {
            el.getCareer = function () {
                return this.career;
            }
            el.getSkills = function (only) {
                var data = this.getData();
                if (data.careerLevel > 1 && only !== true) {
                    return [...oThat.allByCareer[data.getCareer().id][data.careerLevel - 1].getSkills(), ...this.skills]
                }
                return this.skills;
            }
            el.getCharacteristics = function (only) {
                var data = this.getData();
                if (data.careerLevel > 1 && only !== true) {
                    return [...oThat.allByCareer[data.getCareer().id][data.careerLevel - 1].getCharacteristics(), ...this.characteristics]
                }
                return this.characteristics;
            }
            el.getTalents = function () {
                return this.talents;
            }
            el.getTrappings = function (only) {
                var data = this.getData();
                if (data.careerLevel === 1 && only !== true) {
                    return [...data.getCareer().getClass().getTrappings(), ...this.trappings]
                }
                return this.trappings;
            }
            el.getDescription = function () {
                var elem = this.getData();
                return {'tab_actif': elem.careerLevel - (elem.getCareer().desc ? 0 : 1)};
            }
            el.edit = function () {
                var html = EditHelper.inputHidden(this.typeItem, 'typeItem');
                html += EditHelper.inputHidden(this.insertMode, 'insertMode');
                html += EditHelper.inputHidden(this.index, 'index');
                html += EditHelper.paragraph('Carrière',
                    EditHelper.inputSelect(this.getCareer().id, CharGen.data.career.all, 'id', 'label', 'label', 'career', '', true));
                html += EditHelper.paragraph('Niveau de carrière',
                    EditHelper.inputSelect(this.careerLevel, [1, 2, 3, 4], '', '', '', 'careerLevel', 'number', true));
                [elems, el1] = this.status.split(' ');
                html += EditHelper.paragraph('Nom du niveau de carrière', EditHelper.inputText(this.label, 'label'))
                html += EditHelper.paragraph('Statut',
                    EditHelper.inputSelect(elems, ['Bronze', 'Argent', 'Or'], '', '', '', 'status[suffix]') +
                    EditHelper.inputSelect(el1, [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], '', '', '', 'status[label]')
                );
                html += EditHelper.paragraph('Attributs',
                    EditHelper.inputSelects(
                        this.getCharacteristics(true),
                        this.careerLevel === 1 ? 3 : 1,
                        CharGen.data.characteristic.all.filter(v => v.type === 'roll'),
                        'id',
                        'label',
                        'label',
                        'characteristics'
                    )
                );
                html += EditHelper.paragraph('Compétences',
                    EditHelper.inputElems(
                        this.getSkills(true),
                        (10 - this.careerLevel * 2) + (this.careerLevel === 1 ? 2 : 0),
                        CharGen.data.skill.all,
                        'id',
                        'label',
                        'label',
                        'skills'
                    )
                );
                html += EditHelper.paragraph('Talents',
                    EditHelper.inputElems(
                        this.getTalents(),
                        4,
                        CharGen.data.talent.all,
                        'id',
                        'label',
                        'label',
                        'talents'
                    )
                );
                html += EditHelper.paragraph('Equipements',
                    EditHelper.inputTexts(
                        DescriptionHelper.elemsToSimpleArray(this.getTrappings(true)),
                        10,
                        'trappings'
                    ),
                );
                return html;
            }
            el.getLinkedFolder = function () {
                return this.getCareer();
            }
        }
        oThat.generateId = function (el) {
            return Helper.toId(el.career) + '|' + Helper.toId(el.label);
        }
        oThat.parseElems = function (el, match) {
            el.career = DataHelper.stringToElems(CharGen, el.career, el, 'career', true, match).data;
            if (typeof el.career === 'undefined') {
                el.inactive = 1;
            } else {
                el.skills = DataHelper.stringToElems(CharGen, el.skills, el, 'skill', false, match);
                el.talents = DataHelper.stringToElems(CharGen, el.talents, el, 'talent', false, match);
                el.characteristics = DataHelper.stringToElems(CharGen, el.characteristics, el, 'characteristic', false, match);
                el.trappings = DataHelper.stringToElems(CharGen, el.trappings, el, 'trapping', false, match);
                if (typeof oThat.allByCareer[el.career.id] === 'undefined') {
                    oThat.allByCareer[el.career.id] = [];
                }
                oThat.allByCareer[el.career.id][el.careerLevel] = el;
            }
        }

        return oThat;
    }
    this.DataCareerLevel = DataCareerLevel;
</script>